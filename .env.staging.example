# TMS Server Staging Environment Configuration
# This file is configured for Alibaba Cloud ECS deployment
# DO NOT commit this file to git!

# ============================================
# Environment
# ============================================
ENVIRONMENT=staging
DEBUG=true

# ============================================
# Database Configuration (Alibaba Cloud RDS PostgreSQL)
# ============================================
DATABASE_URL=postgresql+asyncpg://postgres:REDACTED_DB_PASSWORD@localhost:5432/tms_staging_db
DATABASE_URL_SYNC=postgresql://postgres:REDACTED_DB_PASSWORD@localhost:5432/tms_staging_db

# ============================================
# Redis Configuration (Alibaba Cloud Tair Redis)
# ============================================
# Using database 1 for staging (production uses 0)
REDIS_URL=redis://:REDACTED_REDIS_PASSWORD@localhost:6379/1
REDIS_PASSWORD=REDACTED_REDIS_PASSWORD

# ============================================
# GCGC User Management System Integration
# ============================================
USER_MANAGEMENT_API_URL=https://tms-staging.example.com
USER_MANAGEMENT_API_KEY=REDACTED_API_KEY
USER_MANAGEMENT_API_TIMEOUT=60
TMS_API_URL=https://tms-staging.example.com
TMS_API_KEY=REDACTED_API_KEY

# ============================================
# JWT Configuration
# ============================================
# CRITICAL: These MUST match GCGC staging's NEXTAUTH_SECRET and tms-client's NEXTAUTH_SECRET
JWT_SECRET=REDACTED_JWT_SECRET
NEXTAUTH_SECRET=REDACTED_JWT_SECRET

# ============================================
# CORS Configuration
# ============================================
# Updated to include Alibaba Cloud domain and localhost for testing
ALLOWED_ORIGINS=https://tms-chat-staging.example.com,http://localhost:3000,http://localhost:3001,https://tms-staging.example.com

# ============================================
# GCGC Login URL
# ============================================
GCGC_LOGIN_URL=https://tms-staging.example.com/auth/signin

# ============================================
# Alibaba Cloud OSS Configuration
# ============================================
# TODO: Get AccessKey from Alibaba Cloud Console (see deployment/GET_OSS_CREDENTIALS.md)
OSS_ACCESS_KEY_ID=YOUR_OSS_ACCESS_KEY_ID_HERE
OSS_ACCESS_KEY_SECRET=YOUR_OSS_ACCESS_KEY_SECRET_HERE
OSS_BUCKET_NAME=tms-oss-goli

# Using internal endpoint (ECS in same region = faster + free bandwidth)
OSS_ENDPOINT=oss-ap-southeast-6-internal.aliyuncs.com

# Optional: Prefix for staging files to separate from production
OSS_PREFIX=staging/

# ============================================
# File Upload Configuration
# ============================================
MAX_FILE_SIZE=104857600  # 100MB in bytes
ALLOWED_FILE_TYPES=image/jpeg,image/png,image/gif,image/webp,video/mp4,video/webm,audio/mpeg,audio/ogg,application/pdf,application/msword,application/vnd.openxmlformats-officedocument.wordprocessingml.document,application/vnd.ms-excel,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet

# ============================================
# Security Configuration
# ============================================
# Session configuration (more relaxed for staging)
SESSION_TIMEOUT=86400  # 24 hours
MAX_LOGIN_ATTEMPTS=10
LOGIN_TIMEOUT=1800  # 30 minutes

# Rate limiting (more relaxed for staging/testing)
API_RATE_LIMIT=200
WS_RATE_LIMIT=100

# ============================================
# WebSocket Configuration
# ============================================
WS_MAX_CONNECTIONS=1000  # Lower limit for staging
WS_HEARTBEAT_INTERVAL=30
WS_CONNECTION_TIMEOUT=300

# ============================================
# Database Connection Pool Configuration
# ============================================
DB_POOL_SIZE=10  # Smaller pool for staging
DB_MAX_OVERFLOW=5
DB_POOL_RECYCLE=3600
DB_POOL_PRE_PING=true

# ============================================
# Cache Configuration
# ============================================
CACHE_DEFAULT_TTL=300  # 5 minutes (shorter for staging)
CACHE_USER_TTL=300
CACHE_PRESENCE_TTL=180  # 3 minutes
CACHE_SESSION_TTL=86400

# ============================================
# Logging
# ============================================
LOG_LEVEL=debug
